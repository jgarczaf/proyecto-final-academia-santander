{"version":3,"file":"fc-calendar.js","sourceRoot":"","sources":["../../../../src/sharedfc/datepicker/calendar/fc-calendar.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FunctionalComponent, h } from '@stencil/core';\r\nimport { FcDatepickerItem } from '../datepicker-item/fc-datepicker-item';\r\nimport {\r\n  addDays,\r\n  findNextValidDay,\r\n  findPrevValidDay,\r\n  getDateBetweenLimits,\r\n  getWeekDaysInitials,\r\n  getWeekDaysNamesFromInitials,\r\n  getWeeks,\r\n  isDisabledDate,\r\n  WeekDays,\r\n  weekStart,\r\n} from '@utils/date-utils';\r\n\r\nexport type FcCalendarType = {\r\n  shownDate?: Date;\r\n  selectedDate?: Date;\r\n  selectedRangeStart?: Date;\r\n  selectedRangeEnd?: Date;\r\n  currentDate?: Date;\r\n  disabledDate?: Date[];\r\n  highlightedDate?: Date[];\r\n  highlightedWeekends: boolean;\r\n  firstDayOfTheWeek?: WeekDays; // 0 = Sunday, 1 = Monday, etc.\r\n  color?: string;\r\n  minDate?: Date;\r\n  maxDate?: Date;\r\n  hasFocus?: boolean;\r\n  onDateSelect: (e: MouseEvent, day: Date) => void;\r\n  onChangeShownDate?: (day: Date) => void;\r\n  onExit?: () => void;\r\n};\r\n\r\nexport const FcCalendar: FunctionalComponent<FcCalendarType> = props => {\r\n  const referenceDate = props.shownDate || props.selectedDate || props.selectedRangeStart || new Date();\r\n\r\n  function onKeyDown(key: KeyboardEvent, day: Date) {\r\n    let nextDate: Date | null = null;\r\n    let isNext = true;\r\n    switch (key.code) {\r\n      case 'ArrowDown':\r\n        nextDate = addDays(day, 7);\r\n        isNext = true;\r\n        break;\r\n\r\n      case 'ArrowUp':\r\n        nextDate = addDays(day, -7);\r\n        isNext = false;\r\n        break;\r\n\r\n      case 'ArrowLeft':\r\n        nextDate = addDays(day, -1);\r\n        isNext = false;\r\n        break;\r\n\r\n      case 'ArrowRight':\r\n        nextDate = addDays(day, 1);\r\n        isNext = true;\r\n        break;\r\n\r\n      case 'Enter':\r\n      case 'Space':\r\n        key.stopPropagation();\r\n        key.preventDefault();\r\n        if (!isDisabledDate(day, props.disabledDate || [], props.minDate, props.maxDate)) {\r\n          props.onDateSelect(null, day);\r\n        }\r\n        return;\r\n      case 'Home':\r\n        nextDate = weekStart(day);\r\n        isNext = true;\r\n        break;\r\n\r\n      case 'End':\r\n        nextDate = addDays(weekStart(day), 6);\r\n        isNext = false;\r\n        break;\r\n\r\n      case 'PageUp':\r\n        nextDate = new Date(day.getFullYear(), day.getMonth() - 1, day.getDate());\r\n        isNext = false;\r\n        break;\r\n      case 'PageDown':\r\n        nextDate = new Date(day.getFullYear(), day.getMonth() + 1, day.getDate());\r\n        isNext = true;\r\n        break;\r\n      case 'Escape':\r\n        key.stopPropagation();\r\n        key.preventDefault();\r\n        props.onExit();\r\n        return;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    key.stopPropagation();\r\n    key.preventDefault();\r\n\r\n    if (key.ctrlKey) {\r\n      if (isNext) {\r\n        props.onChangeShownDate(findNextValidDay(nextDate, props.disabledDate || [], props.minDate, props.maxDate));\r\n      } else {\r\n        props.onChangeShownDate(findPrevValidDay(nextDate, props.disabledDate || [], props.minDate, props.maxDate));\r\n      }\r\n    } else {\r\n      props.onChangeShownDate(getDateBetweenLimits(nextDate, props.minDate, props.maxDate));\r\n    }\r\n  }\r\n\r\n  const selectedDateString = props.selectedDate?.toDateString();\r\n  const selectedRangeStartString = props.selectedRangeStart?.toDateString();\r\n  const selectedRangeEndString = props.selectedRangeEnd?.toDateString();\r\n\r\n  function isSelectedDay(day: Date) {\r\n    const dayString = day.toDateString();\r\n\r\n    if (selectedDateString) {\r\n      return dayString === selectedDateString;\r\n    }\r\n\r\n    if (selectedRangeStartString && !props.selectedRangeEnd) {\r\n      return dayString === selectedRangeStartString;\r\n    }\r\n\r\n    if (selectedRangeEndString && !props.selectedRangeStart) {\r\n      return dayString === selectedRangeEndString;\r\n    }\r\n\r\n    if (selectedRangeStartString && selectedRangeEndString && selectedRangeStartString === selectedRangeEndString) {\r\n      return dayString === selectedRangeStartString;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function isMiddleDay(day: Date) {\r\n    return props.selectedRangeStart && props.selectedRangeEnd ? day > props.selectedRangeStart && day < props.selectedRangeEnd : false;\r\n  }\r\n\r\n  function isStartDay(day: Date) {\r\n    return selectedRangeStartString && !isSelectedDay(day) ? day.toDateString() === selectedRangeStartString : false;\r\n  }\r\n\r\n  function isEndDay(day: Date) {\r\n    return selectedRangeEndString && !isSelectedDay(day) ? day.toDateString() === selectedRangeEndString : false;\r\n  }\r\n\r\n  function isHighlighted(day: Date) {\r\n    if (props.highlightedWeekends && (day.getDay() == 6 || day.getDay() == 0)) {\r\n      return true;\r\n    }\r\n    return props.highlightedDate?.some(d => d.toDateString() === day.toDateString());\r\n  }\r\n\r\n  return (\r\n    <table role=\"grid\" class=\"fc-calendar\">\r\n      <thead class=\"fc-calendar__header-week\">\r\n        {getWeekDaysInitials(props.firstDayOfTheWeek ?? WeekDays.Monday).map(day => (\r\n          <th scope=\"col\" class=\"fc-calendar__header-week__day\" aria-label={getWeekDaysNamesFromInitials(day)}>\r\n            {day}\r\n          </th>\r\n        ))}\r\n      </thead>\r\n      <tbody class=\"fc-calendar__body-week w-full\">\r\n        {getWeeks(referenceDate, props.firstDayOfTheWeek ?? WeekDays.Monday, 6).map((week: Date[]) => (\r\n          <tr class=\"fc-calendar__row-days\">\r\n            {week.map(day => (\r\n              <FcDatepickerItem\r\n                onDatepickerItemRef={el => {\r\n                  if (el && props.hasFocus && day.toDateString() === props.shownDate.toDateString()) {\r\n                    setTimeout(() => {\r\n                      el.focus();\r\n                    }, 1);\r\n                  }\r\n                }}\r\n                onSelect={props.onDateSelect}\r\n                onKeyDown={e => onKeyDown(e, day)}\r\n                value={day}\r\n                type={'day'}\r\n                isFocusable={day.toDateString() === referenceDate.toDateString()}\r\n                isDisabled={isDisabledDate(day, props.disabledDate || [], props.minDate, props.maxDate)}\r\n                isOtherMonth={day.getMonth() !== referenceDate.getMonth()}\r\n                isCurrent={day.toDateString() === (props.currentDate || new Date()).toDateString()}\r\n                isSelected={isSelectedDay(day)}\r\n                isStart={isStartDay(day)}\r\n                isMiddle={isMiddleDay(day)}\r\n                isEnd={isEndDay(day)}\r\n                isHighlighted={isHighlighted(day)}\r\n                color={props.color}\r\n                text={day.getDate().toString()}\r\n              ></FcDatepickerItem>\r\n            ))}\r\n          </tr>\r\n        ))}\r\n      </tbody>\r\n    </table>\r\n  );\r\n};\r\n"]}