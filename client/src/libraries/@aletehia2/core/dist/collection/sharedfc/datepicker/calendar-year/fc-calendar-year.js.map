{"version":3,"file":"fc-calendar-year.js","sourceRoot":"","sources":["../../../../src/sharedfc/datepicker/calendar-year/fc-calendar-year.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FunctionalComponent, h } from '@stencil/core';\r\nimport { FcDatepickerItem } from '../datepicker-item/fc-datepicker-item';\r\nimport {\r\n  compareYears,\r\n  yearStart,\r\n  addYears,\r\n  isCompleteYear,\r\n  findNextValidDay,\r\n  findPrevValidDay,\r\n  getDateBetweenLimits,\r\n} from '@utils/date-utils';\r\n\r\nexport type FcCalendarYearType = {\r\n  shownYear?: Date;\r\n  selectedYear?: Date;\r\n  selectedRangeStart?: Date;\r\n  selectedRangeEnd?: Date;\r\n  currentYear?: Date;\r\n  disabledDates?: Date[];\r\n  highlightedDates?: Date[];\r\n  disabledYears?: Date[];\r\n  highlightedYears?: Date[];\r\n  color?: string;\r\n  minYear?: Date;\r\n  maxYear?: Date;\r\n  hasFocus?: boolean;\r\n  onYearSelect: (e: MouseEvent, day: Date) => void;\r\n  onChangeShownYear?: (day: Date) => void;\r\n  onExit?: () => void;\r\n};\r\n\r\nexport const FcCalendarYear: FunctionalComponent<FcCalendarYearType> = props => {\r\n  const referenceDate = yearStart(props.shownYear || props.selectedYear || new Date());\r\n  let startYear = new Date(new Date().getFullYear() - 7, 0, 1);\r\n\r\n  function getYears(): Date[][] {\r\n    let endYear = new Date(new Date().getFullYear() + 4, 0, 1);\r\n    const years: Date[][] = [];\r\n    let row: Date[] = [];\r\n\r\n    while (startYear > referenceDate || endYear < referenceDate) {\r\n      if (startYear > referenceDate) {\r\n        startYear = addYears(startYear, -12);\r\n        endYear = addYears(endYear, -12);\r\n      } else {\r\n        startYear = addYears(startYear, 12);\r\n        endYear = addYears(endYear, 12);\r\n      }\r\n    }\r\n\r\n    for (let index = 0; index < 12; index++) {\r\n      row.push(new Date(startYear.getFullYear() + index, 0, 1));\r\n      if (index % 3 === 2) {\r\n        years.push(row);\r\n        row = []; // Clear the array for the next row\r\n      }\r\n    }\r\n\r\n    return years;\r\n  }\r\n\r\n  function isSelectedYear(year: Date) {\r\n    if (props.selectedYear) {\r\n      return compareYears(year, props.selectedYear);\r\n    }\r\n\r\n    if (props.selectedRangeStart && !props.selectedRangeEnd) {\r\n      return compareYears(year, props.selectedRangeStart);\r\n    }\r\n\r\n    if (props.selectedRangeEnd && !props.selectedRangeStart) {\r\n      return compareYears(year, props.selectedRangeEnd);\r\n    }\r\n\r\n    if (props.selectedRangeStart && props.selectedRangeEnd && compareYears(props.selectedRangeStart, props.selectedRangeEnd)) {\r\n      return compareYears(year, props.selectedRangeStart);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function isMiddleYear(year: Date) {\r\n    return props.selectedRangeStart && props.selectedRangeEnd ? year > props.selectedRangeStart && year < props.selectedRangeEnd : false;\r\n  }\r\n\r\n  function isStartYear(year: Date) {\r\n    return props.selectedRangeStart && !isSelectedYear(year) ? compareYears(year, props.selectedRangeStart) : false;\r\n  }\r\n\r\n  function isEndYear(year: Date) {\r\n    return props.selectedRangeEnd && !isSelectedYear(year) ? compareYears(year, props.selectedRangeEnd) : false;\r\n  }\r\n\r\n  function isDisabledYear(year: Date): boolean {\r\n    return (\r\n      isCompleteYear(year, props.disabledDates, props.minYear, props.maxYear) ||\r\n      (props.disabledYears && props.disabledYears.some(d => compareYears(year, d)))\r\n    );\r\n  }\r\n\r\n  function isHighlightedYear(year: Date): boolean {\r\n    return (\r\n      isCompleteYear(year, props.highlightedDates) || (props.highlightedYears && props.highlightedYears.some(d => compareYears(year, d)))\r\n    );\r\n  }\r\n\r\n  function onKeyDown(key: KeyboardEvent, year: Date) {\r\n    let nextDate: Date | null = null;\r\n    let isNext = true;\r\n    switch (key.code) {\r\n      case 'ArrowDown':\r\n        nextDate = addYears(year, 3);\r\n        isNext = true;\r\n        break;\r\n\r\n      case 'ArrowUp':\r\n        nextDate = addYears(year, -3);\r\n        isNext = false;\r\n        break;\r\n\r\n      case 'ArrowLeft':\r\n        nextDate = addYears(year, -1);\r\n        isNext = false;\r\n        break;\r\n\r\n      case 'ArrowRight':\r\n        nextDate = addYears(year, 1);\r\n        isNext = true;\r\n        break;\r\n\r\n      case 'Enter':\r\n      case 'Space':\r\n        key.stopPropagation();\r\n        key.preventDefault();\r\n        if (!isDisabledYear(year)) {\r\n          props.onYearSelect(null, getDateBetweenLimits(year, props.minYear, props.maxYear));\r\n        }\r\n\r\n        return;\r\n      case 'Home':\r\n        nextDate = new Date(Math.floor((year.getFullYear() - startYear.getFullYear()) / 3) * 3 + startYear.getFullYear(), 0, 1);\r\n        isNext = true;\r\n        break;\r\n\r\n      case 'End':\r\n        nextDate = new Date(Math.floor((year.getFullYear() - startYear.getFullYear()) / 3) * 3 + startYear.getFullYear() + 2, 0, 1);\r\n        isNext = false;\r\n        break;\r\n\r\n      case 'PageUp':\r\n        nextDate = addYears(year, -12);\r\n        isNext = false;\r\n        break;\r\n      case 'PageDown':\r\n        nextDate = addYears(year, 12);\r\n        isNext = true;\r\n        break;\r\n      case 'Escape':\r\n        key.stopPropagation();\r\n        key.preventDefault();\r\n        props.onExit();\r\n        return;\r\n      default:\r\n        return;\r\n    }\r\n    key.stopPropagation();\r\n    key.preventDefault();\r\n\r\n    if (key.ctrlKey) {\r\n      if (isNext) {\r\n        props.onChangeShownYear(findNextValidDay(nextDate, props.disabledYears || [], props.minYear, props.maxYear));\r\n      } else {\r\n        props.onChangeShownYear(findPrevValidDay(nextDate, props.disabledYears || [], props.minYear, props.maxYear));\r\n      }\r\n    } else {\r\n      props.onChangeShownYear(getDateBetweenLimits(nextDate, props.minYear, props.maxYear));\r\n    }\r\n  }\r\n\r\n  return (\r\n    <table role=\"grid\" class=\"fc-calendar-year\">\r\n      <tbody class=\"fc-calendar-year__rows\">\r\n        {getYears().map((row: Date[]) => (\r\n          <tr class=\"fc-calendar-year__row-years\">\r\n            {row.map(year => (\r\n              <FcDatepickerItem\r\n                onDatepickerItemRef={el => {\r\n                  if (el && compareYears(year, props.shownYear)) {\r\n                    if (props.hasFocus)\r\n                      setTimeout(() => {\r\n                        el.focus();\r\n                      }, 1);\r\n                  }\r\n                }}\r\n                onSelect={props.onYearSelect}\r\n                onKeyDown={e => onKeyDown(e, year)}\r\n                value={year}\r\n                type={'year'}\r\n                isFocusable={compareYears(year, referenceDate)}\r\n                isDisabled={isDisabledYear(year)}\r\n                isCurrent={compareYears(year, props.currentYear)}\r\n                isSelected={isSelectedYear(year)}\r\n                isStart={isStartYear(year)}\r\n                isMiddle={isMiddleYear(year)}\r\n                isEnd={isEndYear(year)}\r\n                isHighlighted={isHighlightedYear(year)}\r\n                color={props.color}\r\n                text={`${year.getFullYear()}`}\r\n              ></FcDatepickerItem>\r\n            ))}\r\n          </tr>\r\n        ))}\r\n      </tbody>\r\n    </table>\r\n  );\r\n};\r\n"]}