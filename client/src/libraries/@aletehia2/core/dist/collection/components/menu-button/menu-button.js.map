{"version":3,"file":"menu-button.js","sourceRoot":"","sources":["../../../src/components/menu-button/menu-button.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, h, JSX, Host, Event, EventEmitter, ComponentInterface, Listen, Element } from '@stencil/core';\r\nimport { Alignment, Alignments } from './menu-button.model';\r\nimport { ButtonColor, ButtonColors, ButtonSize, ButtonSizes } from 'components/button/button.model';\r\n\r\nlet menuButtonSequence = 0;\r\n\r\n@Component({\r\n  tag: 'ath-menu-button',\r\n  styleUrls: ['menu-button.scss'],\r\n  shadow: true,\r\n})\r\nexport class AthMenuButton implements ComponentInterface {\r\n  private hostId = ++menuButtonSequence;\r\n  private overlayId = `menu-button--overlay-${this.hostId}`;\r\n\r\n  @Element() el: HTMLElement | null;\r\n\r\n  /**\r\n   * The overlay's position relative to the origin\r\n   */\r\n  @Prop({ reflect: true }) alignment: Alignments = Alignment.Left;\r\n\r\n  /**\r\n   * Weather the button is focused by default\r\n   */\r\n  @Prop() autofocus: boolean;\r\n\r\n  /**\r\n   * The clear of the button (background and border color)\r\n   */\r\n  @Prop() clear: boolean;\r\n\r\n  /**\r\n   * The color variant of the button\r\n   */\r\n  @Prop() color: ButtonColors = ButtonColor.Primary;\r\n\r\n  /**\r\n   * The button is disabled\r\n   */\r\n  @Prop() disabled: boolean;\r\n\r\n  /**\r\n   * The code of the button's icon (used with iconPosition)\r\n   */\r\n  @Prop() icon = 'placeholder';\r\n\r\n  /**\r\n   * Wheather the menu is open by default\r\n   */\r\n  @Prop({ mutable: true }) open: boolean;\r\n\r\n  /**\r\n   * The size of the button\r\n   */\r\n  @Prop() size: ButtonSizes = ButtonSize.Medium;\r\n\r\n  /**\r\n   * Altura del overlay del menu\r\n   */\r\n  @Prop() overlayMaxHeight: string;\r\n\r\n  // ACCESSIBILITY\r\n  /**\r\n   * The accesible label of the menu-button\r\n   */\r\n  @Prop() athAriaLabel: string;\r\n\r\n  /**\r\n   * Emitted when an item is clicked\r\n   */\r\n  @Event() athAction: EventEmitter<{ item: HTMLAthMenuButtonItemElement }>;\r\n\r\n  private justOpen = false;\r\n\r\n  @Listen('click', { target: 'window' })\r\n  clickOutside(ev: MouseEvent) {\r\n    const path = ev.composedPath();\r\n    if (!path.includes(this.el)) {\r\n      this.open = false;\r\n    }\r\n  }\r\n\r\n  private handleClick = ev => {\r\n    ev.stopPropagation();\r\n    this.open = !this.open;\r\n    this.justOpen = !this.justOpen;\r\n    if (!this.disabled && this.open) {\r\n      const items = Array.from(this.el.querySelectorAll('ath-menu-button-item')) as HTMLElement[];\r\n      const firstItem = items.find(i => !i.hasAttribute('disabled'));\r\n      if (firstItem) {\r\n        items.forEach(item => {\r\n          (item as any).itemTabIndex = item === firstItem ? 0 : -1;\r\n        });\r\n        firstItem.focus();\r\n      }\r\n    }\r\n  };\r\n\r\n  componentDidLoad(): void {\r\n    if (this.autofocus && !this.disabled) {\r\n      this.setFocusToAthButton();\r\n    }\r\n    if (this.open && !this.disabled) {\r\n      this.setFocusToAthButton();\r\n    }\r\n\r\n    const children = Array.from(this.el.querySelectorAll('ath-menu-button-item'));\r\n    children.map(item => (item.tabIndex = -1));\r\n    const htmlChildren: HTMLElement[] = children.map(child => child as unknown as HTMLElement);\r\n    this.manageGroups(htmlChildren);\r\n  }\r\n\r\n  private setFocusToAthButton() {\r\n    const athButton = this.el.shadowRoot.querySelector('ath-button') as HTMLElement;\r\n    athButton.focus();\r\n  }\r\n\r\n  private manageGroups(children: HTMLElement[]): void {\r\n    const groups = this.groupBy(children, item => item.getAttribute('group-name'));\r\n    const allItemsArray = Array.from(children);\r\n    const globalFirstItem = allItemsArray[0];\r\n    const globalLastItem = allItemsArray[allItemsArray.length - 1];\r\n\r\n    let previousGroupName: string | null = null;\r\n\r\n    for (const group in groups) {\r\n      const groupItems = groups[group];\r\n      const firstItem = groupItems[0];\r\n      const lastItem = groupItems[groupItems.length - 1];\r\n\r\n      if (firstItem && lastItem) {\r\n        const separator = document.createElement('ath-divider');\r\n        separator.setAttribute('style', 'width: 100%');\r\n\r\n        // SEPARATORS - Before the first item of the group\r\n        if (firstItem !== globalFirstItem && previousGroupName !== group && firstItem.parentNode) {\r\n          const previousSibling = firstItem.previousElementSibling;\r\n          if (!previousSibling || !previousSibling.matches('ath-divider')) {\r\n            firstItem.parentNode.insertBefore(separator.cloneNode(true), firstItem);\r\n          }\r\n        }\r\n\r\n        // SEPARATORS - After the last item if it's not global last\r\n        if (lastItem !== globalLastItem && lastItem.parentNode) {\r\n          lastItem.parentNode.insertBefore(separator.cloneNode(true), lastItem.nextSibling);\r\n        }\r\n\r\n        // GROUPS\r\n        const groupContainer = document.createElement('div');\r\n        groupContainer.setAttribute('role', 'group');\r\n        groupContainer.setAttribute('aria-label', group);\r\n        groupContainer.setAttribute('style', 'display: contents;');\r\n        firstItem.parentNode.insertBefore(groupContainer, firstItem);\r\n        groupItems.forEach(item => {\r\n          groupContainer.appendChild(item);\r\n        });\r\n\r\n        previousGroupName = group;\r\n      }\r\n    }\r\n  }\r\n  private groupBy<T>(array: T[], keyGetter: (item: T) => string): Record<string, T[]> {\r\n    return array.reduce(\r\n      (result, current) => {\r\n        const key = keyGetter(current);\r\n        if (key) {\r\n          if (!result[key]) {\r\n            result[key] = [];\r\n          }\r\n          result[key].push(current);\r\n        }\r\n\r\n        return result;\r\n      },\r\n      {} as Record<string, T[]>,\r\n    );\r\n  }\r\n\r\n  @Listen('athSelected')\r\n  onClick(ev: CustomEvent) {\r\n    this.open = false;\r\n    this.justOpen = false;\r\n    this.setFocusToAthButton();\r\n    if (ev.detail) {\r\n      this.athAction.emit(ev.detail.target);\r\n    }\r\n    ev.stopPropagation();\r\n  }\r\n\r\n  @Listen('keydown')\r\n  handleKeyDown(ev: KeyboardEvent) {\r\n    if (ev.key === 'Escape' && this.open) {\r\n      ev.preventDefault();\r\n      this.open = false;\r\n      this.setFocusToAthButton();\r\n    }\r\n\r\n    if (ev.key === 'Tab' && this.open) {\r\n      this.open = false;\r\n    }\r\n\r\n    this.focusManager(ev);\r\n  }\r\n\r\n  private focusManager(ev) {\r\n    const items = Array.from(this.el.querySelectorAll<HTMLElement>('ath-menu-button-item')).filter(item => !item.hasAttribute('disabled'));\r\n    const currentElement = document.activeElement as HTMLElement;\r\n    const currentIndex = items.indexOf(currentElement);\r\n\r\n    let nextIndex;\r\n    if (ev.key === 'ArrowDown') {\r\n      ev.preventDefault();\r\n      nextIndex = (currentIndex + 1) % items.length;\r\n    } else if (ev.key === 'ArrowUp') {\r\n      ev.preventDefault();\r\n      if (currentIndex === -1) {\r\n        nextIndex = items.length - 1;\r\n      } else {\r\n        nextIndex = (currentIndex - 1 + items.length) % items.length;\r\n      }\r\n    } else if (ev.key === 'Home') {\r\n      ev.preventDefault();\r\n      nextIndex = 0;\r\n    } else if (ev.key === 'End') {\r\n      ev.preventDefault();\r\n      nextIndex = items.length - 1;\r\n    }\r\n    if (nextIndex !== undefined) {\r\n      items.forEach((item, index) => {\r\n        (item as any).itemTabIndex = index === nextIndex ? 0 : -1;\r\n      });\r\n      items[nextIndex].focus();\r\n    }\r\n  }\r\n\r\n  private getButtonClassNames = () => ({\r\n    'ath-menu-button-disabled': !!this.disabled,\r\n  });\r\n\r\n  private getOverlayClassNames = () => ({\r\n    'ath-menu-button-overlay': true,\r\n    [`position--${this.alignment}`]: !!this.alignment,\r\n  });\r\n\r\n  render(): JSX.Element {\r\n    const styleHeight = this.overlayMaxHeight ? { maxHeight: this.overlayMaxHeight } : { maxHeight: '236px' };\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"ath-menu-button-container\">\r\n          <div>\r\n            <ath-button\r\n              id=\"button-menu\"\r\n              autofocus={!!this.autofocus}\r\n              icon={this.icon}\r\n              icon-position=\"icon-only\"\r\n              clear={this.clear}\r\n              color={this.color}\r\n              disabled={this.disabled}\r\n              size={this.size}\r\n              onAthClick={this.handleClick}\r\n              aria-controls={this.overlayId}\r\n              aria-expanded={!!this.open ? 'true' : 'false'}\r\n              aria-haspopup=\"true\"\r\n              class={this.getButtonClassNames()}\r\n              aria-label={this.athAriaLabel}\r\n            ></ath-button>\r\n          </div>\r\n          {this.open && !this.disabled && (\r\n            <div style={styleHeight} class={this.getOverlayClassNames()} id={this.overlayId} role=\"menu\" tabindex=\"-1\">\r\n              <div class=\"ath-scroll ath-menu-button-overlay-wrapper\">\r\n                <slot></slot>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}