import{a as t,h as e,r as i,c as s,H as a}from"./p-D2-yfY-d.js";import{A as n}from"./p-C4ALHBl6.js";const r={HideAvatar:"hide-avatar"};const h=":host{display:inline-block;width:fit-content}:host .ath-user-menu{display:inline-flex;align-items:center;gap:var(--ath-spacing-user-menu-col-gap)}:host .ath-user-menu-container{width:100%;position:relative}:host .ath-user-menu-overlay{display:flex;padding:var(--ath-spacing-menu-button-overlay-padding);flex-direction:column;align-items:flex-start;gap:var(--ath-spacing-menu-button-overlay-row-gap);position:absolute;right:0;top:4px;border-radius:var(--ath-border-radius-3xl);border:var(--ath-border-width-xs) solid var(--ath-color-border-alpha-bolder-default);background:var(--ath-color-menu-button-overlay-bg);z-index:1000}";let o=0;const d=class{hostId=`user-menu${++o}`;menuOverlayId=`${this.hostId}-overlay`;initials;open=false;srcImage;userName;type=undefined;athAction;get el(){return t(this)}buttonLinkEl;currentIndex=0;firstTimeOpen=true;handleOutsideClick(t){if(!this.el.contains(t.target)){this.open=false}}watchOpenState(){if(this.open){document.addEventListener("mousedown",this.handleOutsideClick)}else{document.removeEventListener("mousedown",this.handleOutsideClick)}}handleClick=t=>{t.stopPropagation();this.toggleMenu()};toggleMenu(){this.open=!this.open;this.buttonLinkEl.setAttribute("aria-expanded",String(this.open));if(!this.open){this.firstTimeOpen=true}}onClick(t){this.open=false;this.currentIndex=-1;this.buttonLinkEl.setAttribute("aria-expanded","false");this.firstTimeOpen=true;this.setFocusToAthButtonLink();if(t.detail){this.athAction.emit(t.detail.target)}t.stopPropagation()}getClassNames=()=>({"ath-user-menu":true});handleKeyDown(t){if(t.key===" "||t.key==="Enter"){t.preventDefault()}if(t.key==="Escape"&&this.open){t.preventDefault();this.open=false;this.buttonLinkEl.setAttribute("aria-expanded","false");this.firstTimeOpen=true;this.currentIndex=-1;this.setFocusToAthButtonLink()}if(t.key==="Tab"&&this.open){this.open=false;this.buttonLinkEl.setAttribute("aria-expanded","false");this.firstTimeOpen=true;this.currentIndex=-1}this.focusManager(t)}focusManager(t){const e=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"];if(e.includes(t.key)){const e=Array.from(this.el.querySelectorAll("ath-menu-button-item"));const i=e.length;let s=this.currentIndex;if(e.length>0){if(t.key==="ArrowUp"||t.key==="ArrowLeft"){!this.firstTimeOpen?s=this.getNextIndex(e,s,-1,i):s=this.getNextIndex(e,i,-1,i)}else if(t.key==="ArrowDown"||t.key==="ArrowRight"){!this.firstTimeOpen?s=this.getNextIndex(e,s,1,i):s=0}else if(t.key==="Home"){s=this.getNextIndex(e,-1,1,i)}else if(t.key==="End"){s=this.getNextIndex(e,i,-1,i)}if(this.firstTimeOpen)this.firstTimeOpen=false;this.currentIndex=s;const a=e[s];e.forEach((t=>{t.itemTabIndex=t===a?0:-1}));a.focus()}}}getNextIndex=(t,e,i,s)=>{let a=(e+i+s)%s;while(t[a].disabled){a=(a+i+s)%s}return a};setFocusToAthButtonLink(){const t=this.el.shadowRoot.querySelector("ath-button-link");t.focus();return}imgTag=()=>{if(!!this.srcImage){const t=this.srcImage;return e("img",{slot:"img",src:t,alt:this.userName})}else{return}};getOverlayClassNames=()=>({"ath-user-menu-overlay":true});getContainerClassNames=()=>({"ath-user-menu-container":true});constructor(t){i(this,t);this.athAction=s(this,"athAction");this.handleOutsideClick=this.handleOutsideClick.bind(this)}disconnectedCallback(){document.removeEventListener("mousedown",this.handleOutsideClick)}componentDidRender(){if(this.open){const t=Array.from(this.el.querySelectorAll("ath-menu-button-item"));const e=t.find((t=>!t.hasAttribute("disabled")));if(e){t.forEach((t=>{t.itemTabIndex=t===e?0:-1}))}}}getAvatarAttributes=()=>({"avatar-name":!!this.userName?this.userName:undefined,initials:!!this.initials?this.initials.substring(0,2):undefined,type:this.type!==r.HideAvatar?this.type:undefined,size:n.ExtraSmall});render(){const t=this.open?"chevron_up":"chevron_down";return e(a,{key:"b5e1d387ec9b6163d607b5995648f459f05a0aa0"},e("div",{key:"72cef12bf1137c536529219a2e30235041d58e0d",class:this.getClassNames()},this.type!==r.HideAvatar&&e("ath-avatar",{key:"ec2d9e43ac32624752dbcd5604d39f5afd20a511",...this.getAvatarAttributes()},this.imgTag()),e("ath-button-link",{key:"238bb58df7fb270c0ad994d7af2e451d76b72aed",ref:t=>this.buttonLinkEl=t,onAthClick:this.handleClick,size:"md",icon:t,"icon-position":"right","aria-controls":this.menuOverlayId,"aria-expanded":String(this.open),"aria-haspopup":"true"},this.userName)),this.open&&e("div",{key:"0828e4e15576a2a5c15e3a8a292ae2deb3dd9e88",class:this.getContainerClassNames()},e("div",{key:"16f11d69100003cb92cd791dcfdf25189014dc2a",class:this.getOverlayClassNames(),role:"menu",tabindex:"-1",id:this.menuOverlayId,"aria-hidden":this.open?"false":"true"},e("slot",{key:"3e6e1a8f091ae2da60dc3cf0c30245527dd439d9"}))))}static get watchers(){return{open:["watchOpenState"]}}};d.style=h;export{d as ath_user_menu};
//# sourceMappingURL=p-71f8858f.entry.js.map