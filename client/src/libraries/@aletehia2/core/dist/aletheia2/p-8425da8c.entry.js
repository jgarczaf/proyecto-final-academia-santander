import{r as t,c as e,a as s,h as i,H as h}from"./p-D2-yfY-d.js";import{T as a,a as l,b as o,c as n,d as r}from"./p-DH9nlGTF.js";import{C as c}from"./p-DynFLFRk.js";const f=":host(.ath-table){display:flex;flex-direction:column;width:100%;min-width:min-content;border-radius:var(--ath-border-radius-table-default)}:host(.ath-table) .ath-table__header{display:flex;flex:0 0 auto}:host(.ath-table) .ath-table__body{display:flex;flex:1 1 auto}:host(.ath-table) .ath-table__footer{flex:0 0 auto}:host(:focus),:host(:focus-visible){box-shadow:0px 0px 0px 2px var(--ath-color-border-focus);display:block;outline:none}:host(.ath-table--primary){background:var(--ath-color-table-bg-primary)}:host(.ath-table--secondary){background:var(--ath-color-table-bg-secondary)}";const b=class{constructor(s){t(this,s);this.athSelectionChange=e(this,"athSelectionChange");this.athTableClick=e(this,"athTableClick")}get el(){return s(this)}size=a.Small;color=l.Primary;frozen;striped=o.None;selectable=n.None;clickable=false;noSelectAll=false;athSelectionChange;athTableClick;handleCollapseToggle(){requestAnimationFrame((()=>this.markLastRow()))}handleSelectAllChange(t){const{selectAll:e}=t.detail;this.rows.forEach((t=>{t.selected=e}));this.emitSelectionChange()}async refresh(){this.collectChildren()}initTimer;headerEl;headerItems=[];rows=[];selectionName=`ath-table-selection-${Math.random().toString(36).slice(2)}`;getSelectAllState(){if(!this.rows||this.rows.length===0){return c.False}const t=this.rows.filter((t=>t.selected)).length;const e=this.rows.length;if(t===0){return c.False}else if(t===e){return c.True}else{return c.Indeterminate}}componentDidLoad(){this.initTimer=window.setTimeout((()=>{this.collectChildren()}),0)}disconnectedCallback(){if(this.initTimer){clearTimeout(this.initTimer)}}handleSelectableChange(){this.collectChildren()}handleClickableChange(){this.collectChildren()}collectChildren(){this.headerEl=this.el.querySelector("ath-table-header");if(this.headerEl){this.headerEl.selectable=this.selectable;this.headerEl.clickable=this.clickable;this.headerEl.noSelectAll=this.noSelectAll;if(this.color)this.headerEl.color=this.color;if(this.size)this.headerEl.size=this.size;if(this.frozen)this.headerEl.frozen=this.frozen}const t=this.el.querySelector("ath-table-body");if(t){this.rows=Array.from(t.querySelectorAll("ath-table-row"));const e=this.rows.some((t=>t.hasChildren||t.parentId));this.ensureParentChildStructure(t);this.rows.forEach((t=>{t.selectable=this.selectable;t.selectionGroupName=this.selectionName;t.reserveClickable=this.clickable;t.reserveExpander=e&&!t.hasChildren;if(this.color)t.color=this.color;if(this.size)t.size=this.size;t.removeEventListener("athRowSelectionChange",this.onRowSelectionChange);t.addEventListener("athRowSelectionChange",this.onRowSelectionChange);t.removeEventListener("athRowClick",this.onRowClick);t.addEventListener("athRowClick",this.onRowClick)}))}this.updateChildrenProps()}ensureParentChildStructure(t){const e=Array.from(t.querySelectorAll("ath-table-row"));if(!e.length)return;const s=new Map;Array.from(t.querySelectorAll("ath-collapse")).forEach((t=>{const e=t.id;if(e)s.set(e,t)}));const i=document.createDocumentFragment();e.forEach((t=>i.appendChild(t)));t.textContent="";const h=e.filter((t=>t.hasChildren&&!!t.rowId));const a=e.filter((t=>!!t.parentId));const l=new Map;a.forEach((t=>{const e=t.parentId;if(!e)return;const s=l.get(e)||[];s.push(t);l.set(e,s)}));const o=e=>t.appendChild(e);for(const t of e){const e=t.hasChildren&&!!t.rowId;const i=!!t.parentId;if(i){continue}if(!e){o(t);continue}o(t);const h=t.rowId;let a=s.get(h);if(!a){a=document.createElement("ath-collapse");a.id=h;a.show=!!t.expanded}o(a);const n=l.get(h)||[];n.forEach((t=>{a.appendChild(t)}))}const n=a.filter((t=>!h.find((e=>e.rowId===t.parentId))));n.forEach((t=>o(t)))}setColumnFixed=t=>{if(this.frozen===r.First&&t.length>0){t[0].frozen=this.frozen;if(this.selectable!==n.None){t[0].style.left="60px"}}if(this.frozen===r.Last&&t.length>0){t[t.length-1].frozen=this.frozen}};interactiveTable;updateChildrenProps(){if(!this.headerItems||!this.rows)return;if(this.headerEl){this.headerItems=Array.from(this.headerEl.querySelectorAll("ath-table-header-item"))}const t=this.headerItems.map((t=>({alignment:t.alignment,cellWidth:t.cellWidth,hasInteractivity:t.hasInteractivity})));this.headerItems.forEach((t=>{if(this.color)t.color=this.color;if(this.size)t.size=this.size}));this.setColumnFixed(this.headerItems);this.rows.forEach((e=>{if(this.striped)e.striped=this.striped;if(this.frozen)e.frozen=this.frozen;if(this.selectable===n.Single){const t=this.rows.filter((t=>t.selected));if(t.length>1){t.slice(1).forEach((t=>t.selected=false))}}const s=Array.from(e.querySelectorAll("ath-table-row-item"));s.forEach(((e,s)=>{const{alignment:i,cellWidth:h,hasInteractivity:a}=t[s]||{};if(h)e.cellWidth=h;if(i)e.alignment=i;if(a){e.hasInteractivity=a;this.interactiveTable=true}if(this.selectable!==n.None||this.clickable||this.interactiveTable){e.role="gridcell"}if(this.color)e.color=this.color;if(this.size)e.size=this.size}));this.setColumnFixed(s)}));this.markLastRow();if(this.headerEl&&this.selectable===n.Multiple){this.headerEl.selectAllState=this.getSelectAllState();this.headerEl.totalRows=this.rows.length;this.headerEl.selectedRows=this.rows.filter((t=>t.selected)).length}}markLastRow(){if(!this.rows||!this.rows.length)return;this.rows.forEach((t=>t.last=false));const t=this.el.querySelector("ath-table-body");if(!t)return;const e=Array.from(t.querySelectorAll("ath-table-row"));for(let t=e.length-1;t>=0;t--){const s=e[t];const i=s.closest("ath-collapse");if(i){const t=i.id;if(t){const e=this.rows.find((e=>e.rowId===t));if(e&&!e.expanded){continue}}}s.last=true;break}}onRowSelectionChange=t=>{const e=t.target;if(this.selectable===n.Single){this.rows.forEach((t=>t.selected=t===e))}this.emitSelectionChange()};onRowClick=t=>{const e=t.target;let s=this.rows.indexOf(e);if(s===-1){if(e.rowId){s=this.rows.findIndex((t=>t.rowId===e.rowId))}else{const t=Array.from(this.el.querySelectorAll("ath-table-row"));s=t.indexOf(e)}}this.athTableClick.emit({rowIndex:s>=0?s:-1,rowValue:e.value,rowId:e.rowId})};emitSelectionChange(){const t=[];const e=[];this.rows.forEach(((s,i)=>{if(s.selected){t.push(i);e.push(s.value)}}));if(this.headerEl&&this.selectable===n.Multiple){this.headerEl.selectAllState=this.getSelectAllState();this.headerEl.totalRows=this.rows.length;this.headerEl.selectedRows=t.length}this.athSelectionChange.emit({selectedIndexes:t,selectedValues:e})}hasHierarchy(){return this.rows?.some((t=>t.hasChildren||t.parentId))??false}isInteractive(){return this.clickable||this.selectable!==n.None||this.interactiveTable}getAttributes=()=>({role:this.hasHierarchy()?"treegrid":this.isInteractive()?"grid":"table",tabindex:this.el.getAttribute("tabindex")||"0"});getHostClassNames=()=>({"ath-table":true,[`ath-table--${this.color}`]:!!this.color});render(){return i(h,{key:"036c192ab5f070f5e8f3f56383c17b95c067fba1",...this.getAttributes(),class:this.getHostClassNames()},i("div",{key:"af1e8bfecbfa86ee2be4beb4f3629f44ff73a98f",class:"ath-table__header",role:"rowgroup"},i("slot",{key:"3906703c67215d78d2a76e30cb72a5c185db1de1",name:"header"})),i("div",{key:"ecf0ca5b5963e01607cb75a21e71d40af4bf82ee",class:"ath-table__body"},i("slot",{key:"3d017696be65f60fab85f82a92a265f3ac37c6e7",name:"body"})),i("div",{key:"af80677570df37ef91da0e26fe485a9125f103c2",class:"ath-table__footer"},i("slot",{key:"3b4b9c81e21dca325747face982b6d41e6d08e1c",name:"footer"})))}static get watchers(){return{selectable:["handleSelectableChange"],clickable:["handleClickableChange"]}}};b.style=f;export{b as ath_table};
//# sourceMappingURL=p-8425da8c.entry.js.map